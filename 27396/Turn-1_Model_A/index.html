<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Game</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    #puzzle-container {
        display: grid;
        gap: 1px;
        background-color: #212121;
        width: 300px;
        height: 300px;
        margin: 20px auto;
    }
    .puzzle-piece {
        background-image: url('path_to_your_image.jpg');
        background-size: 300px 300px;
        border: 1px solid white;
        transition: transform 0.3s;
    }
    #controls, #leaderboard {
        text-align: center;
        margin-top: 20px;
    }
    .animate-win {
        animation: winAnimation 1s ease-in-out;
    }
    @keyframes winAnimation {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
</style>
</head>
<body>

<div class="container">
    <h1 class="text-center">Puzzle Game</h1>
    <div id="puzzle-container"></div>
    <div id="controls">
        <button id="startBtn" class="btn btn-primary">Start Game</button>
        <select id="difficulty" class="form-select" style="display:inline-block; width: auto;">
            <option value="3">Easy (3x3)</option>
            <option value="4">Medium (4x4)</option>
            <option value="5">Hard (5x5)</option>
        </select>
        <div>Time: <span id="timer">0</span>s | Score: <span id="score">0</span></div>
    </div>
    <div id="leaderboard">
        <h2>Leaderboard</h2>
        <ul id="leaderboardList"></ul>
    </div>
</div>

<script>
    const puzzleContainer = document.getElementById('puzzle-container');
    const startBtn = document.getElementById('startBtn');
    const difficultySelect = document.getElementById('difficulty');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');
    let puzzleSize, tiles, emptyTile, timer, score = 0;

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function createPuzzle(size) {
        puzzleSize = size;
        puzzleContainer.style.gridTemplateColumns = `repeat(<INLINE_MATH>{size}, 1fr)`;
        let correctOrder = Array.from({length: size * size}, (_, i) => i + 1);
        correctOrder[correctOrder.length - 1] = 0; // Empty tile
        tiles = correctOrder.slice();
        shuffle(tiles);
        emptyTile = size * size - 1;
        renderPuzzle();
    }

    function renderPuzzle() {
        puzzleContainer.innerHTML = '';
        tiles.forEach((tile, index) => {
            if (tile !== 0) {
                let piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.style.backgroundPosition = `-</INLINE_MATH>{(tile - 1) % puzzleSize * 100}% -<INLINE_MATH>{Math.floor((tile - 1) / puzzleSize) * 100}%`;
                piece.onclick = () => moveTile(index);
                puzzleContainer.appendChild(piece);
            }
        });
    }

    function moveTile(index) {
        if ((index + 1 === emptyTile || index - 1 === emptyTile || 
             (Math.floor(index / puzzleSize) === Math.floor(emptyTile / puzzleSize) && 
              Math.abs(index - emptyTile) === puzzleSize)) && 
            tiles[index] !== 0) {
            [tiles[index], tiles[emptyTile]] = [tiles[emptyTile], tiles[index]];
            emptyTile = index;
            renderPuzzle();
            checkWin();
        }
    }

    function checkWin() {
        if (tiles.every((tile, i) => tile === i + 1 || tile === 0)) {
            puzzleContainer.classList.add('animate-win');
            setTimeout(() => puzzleContainer.classList.remove('animate-win'), 1000);
            score += 100; // Example scoring
            updateScore();
            stopTimer();
            updateLeaderboard();
        }
    }

    function startGame() {
        startBtn.disabled = true;
        createPuzzle(parseInt(difficultySelect.value));
        startTimer();
    }

    let time = 0;
    function startTimer() {
        timer = setInterval(() => {
            time++;
            timerDisplay.textContent = time;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timer);
    }

    function updateScore() {
        scoreDisplay.textContent = score;
    }

    function updateLeaderboard() {
        let leaderboard = JSON.parse(localStorage.getItem('puzzleLeaderboard') || '[]');
        leaderboard.push({score: score, time: time});
        leaderboard.sort((a, b) => b.score - a.score || a.time - b.time);
        localStorage.setItem('puzzleLeaderboard', JSON.stringify(leaderboard.slice(0, 5)));
        displayLeaderboard(leaderboard.slice(0, 5));
    }

    function displayLeaderboard(leaders) {
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = leaders.map((leader, index) => 
            `<li></INLINE_MATH>{index + 1}. Score: \${leader.score}, Time: \${leader.time}s</li>`).join('');
    }

    startBtn.onclick = startGame;
    displayLeaderboard(JSON.parse(localStorage.getItem('puzzleLeaderboard') || '[]'));
</script>

</body>
</html>