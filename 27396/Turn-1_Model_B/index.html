<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Game</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
    \#gameBoard { width: 300px; height: 300px; margin: auto; display: flex; flex-wrap: wrap; }
    .piece { width: 100px; height: 100px; background-size: 300px 300px; transition: transform 0.3s; }
    \#timer, \#score { font-size: 20px; }
    .animate-move { transition: all 0.3s ease; }
</style>
</head>
<body>

<div class="container mt-5">
    <h1>Puzzle Game</h1>
    <div id="gameControls">
        <button id="startGame">Start Game</button>
        <span id="timer">Time: 0s</span>
        <span id="score">Score: 0</span>
    </div>
    <div id="gameBoard"></div>
    <div id="leaderboard" class="mt-3"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "YOUR\_API\_KEY",
        authDomain: "YOUR\_AUTH\_DOMAIN",
        databaseURL: "YOUR\_DATABASE\_URL",
        projectId: "YOUR\_PROJECT\_ID",
        storageBucket: "YOUR\_STORAGE\_BUCKET",
        messagingSenderId: "YOUR\_MESSAGING\_SENDER\_ID",
        appId: "YOUR\_APP\_ID"
    };
    firebase.initializeApp(firebaseConfig);

    const database = firebase.database();
    const leaderboardRef = database.ref('leaderboard');

    const gameBoard = document.getElementById('gameBoard');
    const startButton = document.getElementById('startGame');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');

    let tiles = [];
    let emptyIndex = 8;
    let timer = 0;
    let gameInterval;
    let isGameActive = false;

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function createPuzzle() {
        tiles = [...Array(9).keys()];
        shuffle(tiles);
        emptyIndex = tiles.indexOf(0);
        tiles[emptyIndex] = 8;
        tiles[8] = 0;
        renderPuzzle();
    }

    function renderPuzzle() {
        gameBoard.innerHTML = '';
        tiles.forEach((tile, index) => {
            if (tile !== 8) {
                const piece = document.createElement('div');
                piece.className = 'piece';
                piece.style.backgroundPosition = `-\${(tile \% 3) * 100}px -\${Math.floor(tile / 3) * 100}px`;
                piece.onclick = () => moveTile(index);
                gameBoard.appendChild(piece);
            }
        });
    }

    function moveTile(index) {
        if (!isGameActive) return;
        const canMove = [index - 1, index + 1, index - 3, index + 3].filter(
            newIndex => newIndex >= 0 && newIndex < 9 && Math.abs((newIndex % 3) - (index % 3)) <= 1
        ).includes(emptyIndex);

        if (canMove) {
            [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
            emptyIndex = index;
            renderPuzzle();
            checkWin();
        }
    }

    function checkWin() {
        if (tiles.every((tile, i) => tile === i || tile === 8 && i === 8)) {
            endGame(true);
        }
    }

    function startTimer() {
        gameInterval = setInterval(() => {
            timer++;
            timerDisplay.textContent = `Time: \${timer}s`;
        }, 1000);
    }

    function endGame(win = false) {
        clearInterval(gameInterval);
        isGameActive = false;
        if (win) {
            const score = Math.floor(1000 / (timer || 1));
            scoreDisplay.textContent = `Score: \${score}`;
            addToLeaderboard(score);
        }
    }

    function addToLeaderboard(score) {
        const name = prompt("You won! Enter your name for the leaderboard:");
        if (name) {
            leaderboardRef.push({name, score, timestamp: firebase.database.ServerValue.TIMESTAMP});
        }
    }

    function updateLeaderboard() {
        leaderboardRef.orderByChild('score').limitToLast(10).on('value', (snapshot) => {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '<h2>Leaderboard</h2><ol>' + 
                Object.entries(snapshot.val() || {})
                .reverse()
                .map(([key, {name, score}]) => `<li>\${name}: \${score}</li>`).join('') + 
                '</ol>';
        });
    }

    startButton.onclick = () => {
        if (!isGameActive) {
            isGameActive = true;
            timer = 0;
            createPuzzle();
            startTimer();
        }
    };

    // Initial leaderboard setup
    updateLeaderboard();

    // Listen for changes to update leaderboard in real-time
    leaderboardRef.on('value', updateLeaderboard);
</script>
</body>
</html>