<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Recommendation Widget</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f2f5;
        padding: 20px;
    }
    #recommendationWidget {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #e1e1e1;
        border-radius: 8px;
        background-color: #d35f5f;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease;
    }
    #recommendationWidget:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    h3 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
    }
    .book-item {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #fafafa;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .book-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .book-item h5 {
        font-size: 1.3em;
        margin-bottom: 10px;
        color: #222;
    }
    .book-item p {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 15px;
    }
    .star-rating {
        font-size: 0;
        display: flex;
        gap: 2px;
        cursor: pointer;
    }
    .star-rating span {
        font-size: 24px;
        color: #ddd;
        transition: color 0.3s ease;
    }
    .star-rating span:hover, .star-rating span:hover ~ span, .star-rating span.active {
        color: #ffcc00;
    }
    #genreSelect {
        margin: 20px 0;
    }
</style>
</head>
<body>

<div id="recommendationWidget" class="container">
    <h3>Your Book Recommendations</h3>
    <div id="bookList"></div>
    <div class="mt-3">
        <label for="genreSelect">Select Genre:</label>
        <select id="genreSelect" class="form-control">
            <option value="">All Genres</option>
            <option value="Science">Science</option>
            <option value="Literature">Literature</option>
            <option value="History">History</option>
        </select>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
$(document).ready(function() {
    let userPreferences = {
        ratings: {},
        preferredGenres: []
    };

    function fetchBooks() {
        // Simulated book data to avoid CORS issues and 500 errors
        let data = {
            books: [
                { id: 1, title: "The Science Book", genre: "Science", educationalValue: 5 },
                { id: 2, title: "World History", genre: "History", educationalValue: 4 },
                { id: 3, title: "Literary Masterpieces", genre: "Literature", educationalValue: 4 },
                { id: 4, title: "Physics Essentials", genre: "Science", educationalValue: 5 },
                { id: 5, title: "Historical Events", genre: "History", educationalValue: 3 }
            ]
        };
        displayBooks(recommendBooks(data.books, userPreferences));
    }

    function recommendBooks(books, preferences) {
        return books.sort((a, b) => {
            let scoreA = calculateBookScore(a, preferences);
            let scoreB = calculateBookScore(b, preferences);
            return scoreB - scoreA;
        }).slice(0, 5); // Show top 5 recommendations
    }

    function calculateBookScore(book, preferences) {
        let score = 0;
        if (book.educationalValue) score += book.educationalValue * 2;
        if (preferences.ratings[book.id]) {
            score += preferences.ratings[book.id] * 1.5; // Boost for user-rated books
        }
        if (preferences.preferredGenres.includes(book.genre)) {
            score += 1; // Small boost for preferred genre
        }
        return score;
    }

    function displayBooks(books) {
        let bookList = $('#bookList');
        bookList.empty();
        books.forEach(book => {
            let bookDiv = $('<div class="book-item">').html(`
                <h5>${book.title}</h5>
                <p>Genre: ${book.genre} | Educational Value: ${book.educationalValue}</p>
                <div class="star-rating" data-book-id="${book.id}">
                    <span data-value="1">★</span>
                    <span data-value="2">★</span>
                    <span data-value="3">★</span>
                    <span data-value="4">★</span>
                    <span data-value="5">★</span>
                </div>
            `);
            bookList.append(bookDiv);
        });
        setupRatingSystem();
    }

    function setupRatingSystem() {
        $('.star-rating span').on('click', function() {
            let star = $(this);
            let rating = star.data('value');
            let bookId = star.parent().data('book-id');
            star.siblings().removeClass('active');
            star.prevAll().addBack().addClass('active');
            userPreferences.ratings[bookId] = rating;
            fetchBooks(); // Refresh recommendations
        });
    }

    $('#genreSelect').on('change', function() {
        if (this.value) {
            userPreferences.preferredGenres = [this.value];
        } else {
            userPreferences.preferredGenres = [];
        }
        fetchBooks();
    });

    fetchBooks();
});
</script>

</body>
</html>
