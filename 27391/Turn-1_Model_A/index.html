<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Recommendation Widget</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .book-widget {
            width: 300px;
            border: 1px solid \#ccc;
            padding: 15px;
            font-family: Arial, sans-serif;
        }
        .book-item {
            margin: 10px 0;
            padding: 10px;
            background: \#f9f9f9;
            border-left: 5px solid \#007BFF;
        }
        .stars {
            color: gold;
        }
        .genre-select {
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="book-widget" id="bookWidget">
    <h3>Your Recommendations</h3>
    <div id="bookList"></div>
    <select id="genrePreference" class="genre-select">
        <option value="">Choose a genre</option>
        <!-- Genres would be dynamically added here -->
    </select>
</div>

<script>
    const widget = document.getElementById('bookWidget');
    const bookList = document.getElementById('bookList');
    const genrePreference = document.getElementById('genrePreference');
    let userPreferences = { ratings: {}, genre: '' };
    
    // Mock data for books - this would typically come from an API
    let books = [];

    // Function to fetch books from an API
    async function fetchBooks() {
        try {
            const response = await fetch('https://api.example.com/books'); // Replace with actual API endpoint
            books = await response.json();
            updateRecommendations();
        } catch (error) {
            console.error('Failed to fetch books:', error);
        }
    }

    function rateBook(bookId, stars) {
        userPreferences.ratings[bookId] = stars;
        updateRecommendations();
    }

    function recommendBooks() {
        return books.sort((a, b) => {
            let scoreA = (a.educationalValue * 2) + ((userPreferences.ratings[a.id] || 0) * 3) + (a.genre === userPreferences.genre ? 5 : 0);
            let scoreB = (b.educationalValue * 2) + ((userPreferences.ratings[b.id] || 0) * 3) + (b.genre === userPreferences.genre ? 5 : 0);
            return scoreB - scoreA;
        });
    }

    function updateRecommendations() {
        const recommendedBooks = recommendBooks().slice(0, 5); // Top 5 books
        bookList.innerHTML = '';
        recommendedBooks.forEach(book => {
            const bookDiv = document.createElement('div');
            bookDiv.className = 'book-item';
            bookDiv.innerHTML = `
                <h4>\${book.title}</h4>
                <p>Genre: \${book.genre}</p>
                <div class="stars" data-book-id="\${book.id}">
                    \${[1,2,3,4,5].map(star => `<i class="fa fa-star" data-value="\${star}" onclick="rateBook('\${book.id}', \${star})"></i>`).join('')}
                </div>
            `;
            bookList.appendChild(bookDiv);
        });
    }

    // Populate genres and setup event listeners
    function setupGenres() {
        const genres = [...new Set(books.map(book => book.genre))];
        genres.forEach(genre => {
            const option = document.createElement('option');
            option.value = genre;
            option.textContent = genre;
            genrePreference.appendChild(option);
        });
        genrePreference.onchange = function() {
            userPreferences.genre = this.value;
            updateRecommendations();
        };
    }

    // Initialize widget
    fetchBooks().then(() => {
        setupGenres();
        updateRecommendations();
    });
</script>

</body>
</html>